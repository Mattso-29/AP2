import streamlit as st
import folium
from streamlit_folium import st_folium
import pandas as pd

# Données fictives pour les indices boursiers
indices_boursiers = {
    "France": {"CAC 40": 6000, "SBF 120": 4800},
    "Allemagne": {"DAX": 15000, "MDAX": 32000},
    "Portugal": {"PSI 20": 5200},
    "Suisse": {"SMI": 11000, "SPI": 14000}
}

# Coordonnées simplifiées des polygones pour chaque pays
geojson_data = {
    "France": {
        "type": "Feature",
        "geometry": {
            "type": "Polygon",
            "coordinates": [[
               [2.513573, 51.148506], [2.658422, 50.796848], [3.123252, 50.780363], [3.588184, 50.378992],
                [3.625454, 50.300000], [3.680000, 50.220000], [3.720000, 50.140000], [3.760000, 50.080000],
                [3.810000, 50.020000], [3.850000, 49.960000], [3.900000, 49.900000], [3.950000, 49.850000],
                [4.286023, 49.907497], [4.799222, 49.985373], [5.674052, 49.529484], [5.897759, 49.442667],
                [6.186320, 49.463803], [6.658230, 49.201958], [8.099279, 48.922213], [7.593676, 48.333019],
                [7.466759, 47.620582], [7.192202, 47.449766], [6.736571, 47.541801], [6.768714, 47.287708],
                [6.037389, 46.725779], [6.022609, 46.272987], [6.500100, 46.429673], [6.843593, 45.991147],
                [6.802355, 45.708580], [7.096652, 45.333099], [6.749955, 45.028518], [7.007562, 44.254767],
                [7.549596, 44.127901], [7.435185, 43.693845], [6.529245, 43.128892], [4.556963, 43.399651],
                [3.100411, 43.075201], [2.985999, 42.473015], [1.826793, 42.343385], [1.450982, 42.614127],
                [0.701591, 42.795734], [0.338047, 42.579546], [-1.502771, 43.034014], [-1.901351, 43.422802],
                [-1.384225, 44.022610], [-1.193798, 44.386964], [-1.733145, 44.854920], [-1.387163, 45.625050],
                [-1.193798, 45.459950], [-2.225724, 47.064363], [-2.963276, 47.570327], [-3.410000, 47.750000],
                [-3.800000, 47.900000], [-4.100000, 48.000000], [-4.300000, 48.200000], [-4.491555, 47.954954],
                [-4.592350, 48.684160], [-3.295814, 48.901692], [-2.200000, 48.600000], [-1.616511, 48.644421],
                [-1.933494, 49.776342], [-0.989469, 49.347376], [1.338761, 49.041800], [1.932797, 49.776342],
                [2.200000, 50.000000], [2.300000, 50.100000], [2.400000, 50.200000], [2.500000, 50.300000],
                [2.600000, 50.400000], [2.700000, 50.500000], [2.800000, 50.600000], [2.900000, 50.700000],
                [3.000000, 50.800000], [2.513573, 51.148506]
            ]]
        }
    },
"Allemagne": {
        "type": "Feature",
        "geometry": {
            "type": "Polygon",
            "coordinates": [[
                [6.658230, 49.201958], [8.099279, 48.922213], [8.317301, 48.000779], [9.220000, 47.525000],
                [9.580000, 47.302487], [9.594226, 47.525058], [10.449000, 47.453000], [10.988000, 47.302000],
                [11.333333, 47.272697], [11.621900, 47.234900], [12.141500, 47.703400], [13.035500, 47.703400],
                [12.932627, 47.574800], [13.624300, 47.347400], [13.825300, 47.525700], [14.553300, 46.722000],
                [14.630000, 47.071500], [14.595800, 47.592200], [15.096100, 47.912300], [15.690800, 48.003300],
                [15.940900, 48.305300], [15.253100, 48.550900], [14.594100, 48.684800], [13.243357, 49.308434],
                [12.884103, 49.521096], [12.519581, 49.547415], [12.415191, 49.969121], [11.980166, 50.034305],
                [11.624033, 50.201992], [10.939467, 50.153601], [10.454140, 50.329413], [10.332752, 50.435146],
                [10.250487, 50.721722], [9.922837, 50.870391], [9.207140, 51.048353], [8.740000, 51.056000],
                [8.315300, 51.529700], [7.255180, 51.165696], [6.074183, 51.267258], [6.074183, 50.803721],
                [6.242751, 50.679700], [6.043073, 50.128052], [5.782417, 50.090327], [5.981052, 49.995185],
                [6.082177, 49.658624], [6.242751, 49.902225], [6.186320, 49.463803], [6.658230, 49.201958]
            ]]
        }
    },
    "Portugal": {
        "type": "Feature",
        "geometry": {
            "type": "Polygon",
            "coordinates": [[
                [-9.034818, 41.880570], [-8.671945, 42.134689], [-8.263857, 42.280469], [-8.013174, 41.790886],
                [-7.422513, 41.792075], [-7.251309, 41.918346], [-6.668606, 41.883387], [-6.389088, 41.381815],
                [-6.688129, 41.060944], [-7.026413, 40.631419], [-7.066592, 40.184524], [-7.374092, 39.711892],
                [-7.098037, 39.030073], [-7.498632, 38.484519], [-7.495437, 37.904098], [-7.855613, 37.546944],
                [-8.382816, 37.754467], [-8.898857, 38.268756], [-9.287464, 38.358486], [-9.526570, 38.737429],
                [-9.446989, 39.392066], [-9.048305, 39.755093], [-8.977353, 40.159306], [-8.768684, 40.760639],
                [-8.790853, 41.184334], [-8.990789, 41.543459], [-9.034818, 41.880570]
            ]]
        }
    },
    "Suisse": {
        "type": "Feature",
        "geometry": {
            "type": "Polygon",
            "coordinates": [[
                [8.317301, 47.613580], [9.594226, 47.525058], [9.632932, 47.347601], [9.479970, 47.102810],
                [9.932448, 46.920728], [10.442701, 46.893546], [10.363378, 46.483571], [9.922837, 46.314899],
                [9.182882, 46.440215], [9.013602, 46.525058], [8.305346, 46.666667], [8.224157, 46.990528],
                [7.755379, 46.996682], [7.273851, 46.705129], [6.768714, 47.287708], [6.736571, 47.541801],
                [6.084666, 47.541801], [6.022609, 47.683723], [5.484203, 47.835241], [5.352254, 47.788575],
                [5.266007, 47.302000], [6.843593, 46.712939], [8.317301, 47.613580]
            ]]
        }
    }
}

def afficher_indice_pays(pays):
    st.title(f"Indices boursiers pour {pays}")
    if pays in indices_boursiers:
        data = indices_boursiers[pays]
        df = pd.DataFrame(list(data.items()), columns=["Indice", "Valeur"])
        st.table(df)
    else:
        st.write("Données non disponibles.")

def afficher_carte():
    m = folium.Map(location=[48.8566, 2.3522], zoom_start=4)

    # Ajouter des polygones colorés pour chaque pays
    couleurs = {
        "France": "blue",
        "Allemagne": "yellow",
        "Portugal": "green",
        "Suisse": "red"
    }

    for pays, geojson in geojson_data.items():
        folium.GeoJson(
            geojson,
            style_function=lambda x, couleur=couleurs[pays]: {'color': couleur, 'fillColor': couleur, 'fillOpacity': 0.5},
            highlight_function=lambda x: {'weight': 3, 'color': 'black'},
            tooltip=folium.Tooltip(pays),
            popup=folium.Popup(f"<a href='?pays={pays}'>{pays}</a>")
        ).add_to(m)

    st_folium(m, width=700, height=500)

# Début de l'application Streamlit
st.set_page_config(page_title="Carte des Indices Boursiers", layout="wide")

pays_selectionne = st.experimental_get_query_params().get('pays', [None])[0]

if pays_selectionne:
    afficher_indice_pays(pays_selectionne)
else:
    st.title("Carte des Indices Boursiers en Europe")
    afficher_carte()
