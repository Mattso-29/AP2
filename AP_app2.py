import streamlit as st
import folium
from streamlit_folium import st_folium
import pandas as pd

# Données fictives pour les indices boursiers
indices_boursiers = {
    "France": {"CAC 40": 6000, "SBF 120": 4800},
    "Allemagne": {"DAX": 15000, "MDAX": 32000},
    "Portugal": {"PSI 20": 5200},
    "Suisse": {"SMI": 11000, "SPI": 14000}
}

# Coordonnées simplifiées des polygones pour chaque pays
geojson_data = {
    "France": {
        "type": "Feature",
        "geometry": {
            "type": "Polygon",
            "coordinates": [[
    [2.5160965424793744, 51.062061390974804],
    [1.6689832206209871, 50.91957528888247],
    [1.5991928340295374, 50.316619680545585],
    [1.355391926990535, 50.043808424074854],
    [0.718745404110706, 49.839243995462965],
    [0.15341927383360598, 49.66326687140614],
    [0.17334515656585836, 49.37999880054517],
    [-0.6231793025797856, 49.299669326118334],
    [-1.18124597958942, 49.35714016316925],
    [-1.3258795494349158, 49.63695494664097],
    [-1.8220174041476582, 49.6946512568027],
    [-1.6322226528700128, 49.2516825505042],
    [-1.5083797632303515, 48.73319108231888],
    [-1.3558083160947376, 48.574752026080375],
    [-1.9589930704486846, 48.6708893732104],
    [-2.564406624251859, 48.55502686138962],
    [-3.079175035062491, 48.78535120554639],
    [-3.716922072978747, 48.692414577807426],
    [-4.61226152678168, 48.58043305574324],
    [-4.809256070643727, 48.356790369118556],
    [-4.2414718719756195, 48.31656359488068],
    [-4.303179272057463, 48.117207760505806],
    [-4.66196975346196, 48.03446778297979],
    [-4.300761468710533, 47.80150143762941],
    [-3.61099306870409, 47.79767854012465],
    [-2.4838203846507554, 47.48352353860196],
    [-2.435438788851627, 47.24722439638364],
    [-2.094670367843719, 47.189018123379896],
    [-2.0387932974817886, 46.84896044508136],
    [-1.7797314941404068, 46.428961166280175],
    [-1.0868749176955248, 46.220813092553385],
    [-1.1016449045582704, 45.83296970236847],
    [-1.2423040092627105, 45.69272085156791],
    [-1.1422602739617105, 45.18902479597256],
    [-1.2925273226015292, 44.25039579998227],
    [-1.520340244888871, 43.52619265732048],
    [-1.7602388955483548, 43.34507385031415],
    [-1.179802720769061, 43.04024724417633],
    [-0.5072276517030048, 42.81215724997199],
    [0.5028220219249135, 42.682700446534795],
    [0.683808938870726, 42.780393898722195],
    [1.2562880720953729, 42.75007381811733],
    [1.7084160545974214, 42.52983086185907],
    [2.4807210311180654, 42.387117477857714],
    [3.2497535759328002, 42.4214824532834],
    [3.0461608170357124, 42.92620809750531],
    [3.495102820187128, 43.275835924707195],
    [3.9268455731119616, 43.54613555355016],
    [4.7860214425641345, 43.368754686072265],
    [5.806407154599555, 43.14709756934133],
    [6.670123130064667, 43.13229984458391],
    [6.955546718432771, 43.501188151711034],
    [7.653409408344828, 43.6971320862304],
    [7.649404898266852, 43.9852902794824],
    [7.639366856738661, 44.167160226720654],
    [7.01413307745463, 44.25498450660078],
    [6.904981981086564, 44.57507169199434],
    [6.963365535007625, 44.872706270777826],
    [6.700068894974805, 45.09177288157247],
    [7.183118379710606, 45.35762476306937],
    [6.987247210012043, 45.648394818348436],
    [6.805459223830326, 45.833468188904476],
    [7.088650525577265, 45.897806239934795],
    [6.849313749377501, 46.20361188744724],
    [6.860419457696111, 46.38144505422733],
    [6.316858089423647, 46.32410004684533],
    [6.22389698734807, 46.19322047418092],
    [6.050013062978195, 46.15344047298771],
    [6.123134567209092, 46.32945518208527],
    [6.068073662897916, 46.52357887373702],
    [6.31366879363685, 46.66515683984167],
    [6.501808968397569, 46.91171034805248],
    [6.800593244020519, 47.139851937103884],
    [7.054321884995858, 47.30965628491924],
    [7.024251431620854, 47.503452288261514],
    [7.534968410764094, 47.51557813599004],
    [7.596446641132729, 47.97391632515013],
    [7.846641010189302, 48.48566329509575],
    [8.184673086724843, 48.890797978239675],
    [7.903001973077153, 49.050533165311435],
    [7.455449317123538, 49.17010796116196],
    [7.135245455535085, 49.17987577258128],
    [6.838326335589613, 49.188240611207675],
    [6.4906668256054445, 49.43583335747678],
    [6.035556931116304, 49.490738286385294],
    [5.647260992743412, 49.513072363248966],
    [5.441365394471205, 49.51655173008575],
    [5.220775194921686, 49.69893343174476],
    [4.837325644049429, 49.88308192519011],
    [4.8712018829007775, 50.167003256159745],
    [4.610403568076833, 49.99011637212163],
    [4.287386011071618, 49.992869118894816],
    [4.177315841394318, 50.233125473122215],
    [3.9706461751845836, 50.35425691833373],
    [3.690925415026072, 50.295395852919995],
    [3.6464999975064245, 50.50563255226845],
    [3.3664834562625856, 50.52114870775773],
    [3.2263124138072214, 50.686632272673734],
    [3.1791658412407173, 50.837287709602606],
    [2.851093519411478, 50.70115459695771],
    [2.6381822306576055, 50.82097872161975],
    [2.5160965424793744, 51.062061390974804]
 ]]
        }
    },
"Allemagne": {
        "type": "Feature",
        "geometry": {
            "type": "Polygon",
            "coordinates": [[
    [2.5160965424793744, 51.062061390974804],
    [1.6689832206209871, 50.91957528888247],
    [1.5991928340295374, 50.316619680545585],
    [1.355391926990535, 50.043808424074854],
    [0.718745404110706, 49.839243995462965],
    [0.15341927383360598, 49.66326687140614],
    [0.17334515656585836, 49.37999880054517],
    [-0.6231793025797856, 49.299669326118334],
    [-1.18124597958942, 49.35714016316925],
    [-1.3258795494349158, 49.63695494664097],
    [-1.8220174041476582, 49.6946512568027],
    [-1.6322226528700128, 49.2516825505042],
    [-1.5083797632303515, 48.73319108231888],
    [-1.3558083160947376, 48.574752026080375],
    [-1.9589930704486846, 48.6708893732104],
    [-2.564406624251859, 48.55502686138962],
    [-3.079175035062491, 48.78535120554639],
    [-3.716922072978747, 48.692414577807426],
    [-4.61226152678168, 48.58043305574324],
    [-4.809256070643727, 48.356790369118556],
    [-4.2414718719756195, 48.31656359488068],
    [-4.303179272057463, 48.117207760505806],
    [-4.66196975346196, 48.03446778297979],
    [-4.300761468710533, 47.80150143762941],
    [-3.61099306870409, 47.79767854012465],
    [-2.4838203846507554, 47.48352353860196],
    [-2.435438788851627, 47.24722439638364],
    [-2.094670367843719, 47.189018123379896],
    [-2.0387932974817886, 46.84896044508136],
    [-1.7797314941404068, 46.428961166280175],
    [-1.0868749176955248, 46.220813092553385],
    [-1.1016449045582704, 45.83296970236847],
    [-1.2423040092627105, 45.69272085156791],
    [-1.1422602739617105, 45.18902479597256],
    [-1.2925273226015292, 44.25039579998227],
    [-1.520340244888871, 43.52619265732048],
    [-1.7602388955483548, 43.34507385031415],
    [-1.179802720769061, 43.04024724417633],
    [-0.5072276517030048, 42.81215724997199],
    [0.5028220219249135, 42.682700446534795],
    [0.683808938870726, 42.780393898722195],
    [1.2562880720953729, 42.75007381811733],
    [1.7084160545974214, 42.52983086185907],
    [2.4807210311180654, 42.387117477857714],
    [3.2497535759328002, 42.4214824532834],
    [3.0461608170357124, 42.92620809750531],
    [3.495102820187128, 43.275835924707195],
    [3.9268455731119616, 43.54613555355016],
    [4.7860214425641345, 43.368754686072265],
    [5.806407154599555, 43.14709756934133],
    [6.670123130064667, 43.13229984458391],
    [6.955546718432771, 43.501188151711034],
    [7.653409408344828, 43.6971320862304],
    [7.649404898266852, 43.9852902794824],
    [7.639366856738661, 44.167160226720654],
    [7.01413307745463, 44.25498450660078],
    [6.904981981086564, 44.57507169199434],
    [6.963365535007625, 44.872706270777826],
    [6.700068894974805, 45.09177288157247],
    [7.183118379710606, 45.35762476306937],
    [6.987247210012043, 45.648394818348436],
    [6.805459223830326, 45.833468188904476],
    [7.088650525577265, 45.897806239934795],
    [6.849313749377501, 46.20361188744724],
    [6.860419457696111, 46.38144505422733],
    [6.316858089423647, 46.32410004684533],
    [6.22389698734807, 46.19322047418092],
    [6.050013062978195, 46.15344047298771],
    [6.123134567209092, 46.32945518208527],
    [6.068073662897916, 46.52357887373702],
    [6.31366879363685, 46.66515683984167],
    [6.501808968397569, 46.91171034805248],
    [6.800593244020519, 47.139851937103884],
    [7.054321884995858, 47.30965628491924],
    [7.024251431620854, 47.503452288261514],
    [7.534968410764094, 47.51557813599004],
    [7.596446641132729, 47.97391632515013],
    [7.846641010189302, 48.48566329509575],
    [8.184673086724843, 48.890797978239675],
    [7.903001973077153, 49.050533165311435],
    [7.455449317123538, 49.17010796116196],
    [7.135245455535085, 49.17987577258128],
    [6.838326335589613, 49.188240611207675],
    [6.4906668256054445, 49.43583335747678],
    [6.035556931116304, 49.490738286385294],
    [5.647260992743412, 49.513072363248966],
    [5.441365394471205, 49.51655173008575],
    [5.220775194921686, 49.69893343174476],
    [4.837325644049429, 49.88308192519011],
    [4.8712018829007775, 50.167003256159745],
    [4.610403568076833, 49.99011637212163],
    [4.287386011071618, 49.992869118894816],
    [4.177315841394318, 50.233125473122215],
    [3.9706461751845836, 50.35425691833373],
    [3.690925415026072, 50.295395852919995],
    [3.6464999975064245, 50.50563255226845],
    [3.3664834562625856, 50.52114870775773],
    [3.2263124138072214, 50.686632272673734],
    [3.1791658412407173, 50.837287709602606],
    [2.851093519411478, 50.70115459695771],
    [2.6381822306576055, 50.82097872161975],
    [2.5160965424793744, 51.062061390974804]
]]
        }
    },
    "Portugal": {
        "type": "Feature",
        "geometry": {
            "type": "Polygon",
            "coordinates": [[
                [7.169835086839441, 45.88544370119848],
    [7.095586577067918, 45.875083121436475],
    [6.992385503468452, 46.019180910926224],
    [6.853539338534683, 46.206527419728836],
    [6.846070937722789, 46.38724064302782],
    [6.346408951844905, 46.328050158904375],
    [6.231689923433758, 46.191603021664136],
    [6.053694726613083, 46.17664483259057],
    [6.1335870838630635, 46.32934473090795],
    [6.116970895022611, 46.415374094331206],
    [6.078137216731081, 46.51469440781044],
    [6.328829176713807, 46.66712858892248],
    [6.569640022232832, 46.95861136435961],
    [7.022309149443053, 47.28341473441237],
    [7.058269594373103, 47.34649209197589],
    [7.045975766256543, 47.5010939907212],
    [7.436374858216055, 47.49684358028614],
    [7.919117658676711, 47.549151232457625],
    [8.172552627168706, 47.59158870218113],
    [8.421162168356062, 47.607980703475576],
    [8.558246079108017, 47.64817412682084],
    [8.44923319732638, 47.714402978817276],
    [8.597939908911915, 47.81438693297015],
    [8.808495640599155, 47.696232223420154],
    [9.162051121710917, 47.65447522776724],
    [9.48182861169007, 47.5474740830368],
    [9.61276479285176, 47.47768200091822],
    [9.65684328253218, 47.40788991879964],
    [9.667840328902598, 47.37521637759963],
    [9.555670455922037, 47.30678803542339],
    [9.472092903505136, 47.18181595784263],
    [9.524878726085394, 47.11959328674191],
    [9.480890540602374, 47.05737061564119],
    [9.787708134343694, 47.03319253183095],
    [9.884207216246477, 47.02412726707381],
    [9.883932290086037, 46.92505624909002],
    [10.068132816795039, 46.88900340774007],
    [10.10524784829538, 46.85210798377227],
    [10.168755791085694, 46.857330819585044],
    [10.24298585408876, 46.921882707648166],
    [10.409041254285803, 46.99681657817136],
    [10.48657043119799, 46.940207799933496],
    [10.467325600049284, 46.85355667319274],
    [10.390896127773427, 46.67348207313643],
    [10.489044766631466, 46.61061652880427],
    [10.455228849041848, 46.535660225497246],
    [10.108821888367006, 46.61661496569012],
    [10.041190053187208, 46.490634599587985],
    [10.158308597033738, 46.410165627173],
    [10.140713322841634, 46.300872049656164],
    [10.17150505267881, 46.24310026017787],
    [10.079129863166173, 46.22180056543593],
    [10.021945222037914, 46.27959479114628],
    [9.98675467365237, 46.361618673354656],
    [9.88558184704192, 46.370724847752314],
    [9.744819653497643, 46.346438342685076],
    [9.718426742208806, 46.291754236695255],
    [9.58542130068841, 46.29058490512185],
    [9.4669995122959, 46.37235337807451],
    [9.453335459788804, 46.51045232808329],
    [9.416897986437732, 46.466549721856694],
    [9.371351144747365, 46.507317602768126],
    [9.284812145536904, 46.48850545435542],
    [9.257484040523906, 46.44144660821985],
    [9.289366829705926, 46.40062936825518],
    [9.284812145536904, 46.35663816570974],
    [9.284812145536904, 46.29058490512185],
    [9.20282783049663, 46.1992373783755],
    [9.098070094610051, 46.12036741937587],
    [9.098070094610051, 46.07615085822019],
    [9.029749832075709, 46.04454589143285],
    [9.00697641123051, 45.97495128133343],
    [9.025195147906686, 45.936953675520954],
    [9.088960726272006, 45.89576019997904],
    [9.029749832075709, 45.81963036518471],
    [8.920437412020078, 45.835499342834254],
    [8.94776551703427, 45.870395169411665],
    [8.897663991176103, 45.95595573525324],
    [8.788351571120444, 45.984446611799655],
    [8.829343728641703, 46.0919465575233],
    [8.715476624417022, 46.0919465575233],
    [8.606164204362614, 46.155084129680944],
    [8.460414310955855, 46.24020507964099],
    [8.437640890110686, 46.29687912789802],
    [8.47407836346295, 46.384922293059105],
    [8.437640890110686, 46.463412465457026],
    [8.305555049211051, 46.4288907120785],
    [8.319219101718147, 46.40062936825518],
    [8.273672260027809, 46.36292479314707],
    [8.21446136583154, 46.30946540325735],
    [8.137031734959123, 46.30317262727428],
    [8.086930209100956, 46.26854942852262],
    [8.118812998283005, 46.246505089875996],
    [8.164359839973343, 46.18977895248844],
    [8.15525047163527, 46.14246240388232],
    [8.027719314904658, 46.09826357091029],
    [8.018609946566613, 46.016085953093665],
    [7.8956334740038585, 45.984446611799655],
    [7.831867895638538, 45.924282016933006],
    [7.603935460709835, 45.99015578378862],
    [7.3929619873358945, 45.92071933114531],
    [7.169835086839441, 45.88544370119848]
            ]]
        }
    },
    "Suisse": {
        "type": "Feature",
        "geometry": {
            "type": "Polygon",
            "coordinates": [[
                [7.169835086839441, 45.88544370119848],
    [7.095586577067918, 45.875083121436475],
    [6.992385503468452, 46.019180910926224],
    [6.853539338534683, 46.206527419728836],
    [6.846070937722789, 46.38724064302782],
    [6.346408951844905, 46.328050158904375],
    [6.231689923433758, 46.191603021664136],
    [6.053694726613083, 46.17664483259057],
    [6.1335870838630635, 46.32934473090795],
    [6.116970895022611, 46.415374094331206],
    [6.078137216731081, 46.51469440781044],
    [6.328829176713807, 46.66712858892248],
    [6.569640022232832, 46.95861136435961],
    [7.022309149443053, 47.28341473441237],
    [7.058269594373103, 47.34649209197589],
    [7.045975766256543, 47.5010939907212],
    [7.436374858216055, 47.49684358028614],
    [7.919117658676711, 47.549151232457625],
    [8.172552627168706, 47.59158870218113],
    [8.421162168356062, 47.607980703475576],
    [8.558246079108017, 47.64817412682084],
    [8.44923319732638, 47.714402978817276],
    [8.597939908911915, 47.81438693297015],
    [8.808495640599155, 47.696232223420154],
    [9.162051121710917, 47.65447522776724],
    [9.48182861169007, 47.5474740830368],
    [9.61276479285176, 47.47768200091822],
    [9.65684328253218, 47.40788991879964],
    [9.667840328902598, 47.37521637759963],
    [9.555670455922037, 47.30678803542339],
    [9.472092903505136, 47.18181595784263],
    [9.524878726085394, 47.11959328674191],
    [9.480890540602374, 47.05737061564119],
    [9.787708134343694, 47.03319253183095],
    [9.884207216246477, 47.02412726707381],
    [9.883932290086037, 46.92505624909002],
    [10.068132816795039, 46.88900340774007],
    [10.10524784829538, 46.85210798377227],
    [10.168755791085694, 46.857330819585044],
    [10.24298585408876, 46.921882707648166],
    [10.409041254285803, 46.99681657817136],
    [10.48657043119799, 46.940207799933496],
    [10.467325600049284, 46.85355667319274],
    [10.390896127773427, 46.67348207313643],
    [10.489044766631466, 46.61061652880427],
    [10.455228849041848, 46.535660225497246],
    [10.108821888367006, 46.61661496569012],
    [10.041190053187208, 46.490634599587985],
    [10.158308597033738, 46.410165627173],
    [10.140713322841634, 46.300872049656164],
    [10.17150505267881, 46.24310026017787],
    [10.079129863166173, 46.22180056543593],
    [10.021945222037914, 46.27959479114628],
    [9.98675467365237, 46.361618673354656],
    [9.88558184704192, 46.370724847752314],
    [9.744819653497643, 46.346438342685076],
    [9.718426742208806, 46.291754236695255],
    [9.58542130068841, 46.29058490512185],
    [9.4669995122959, 46.37235337807451],
    [9.453335459788804, 46.51045232808329],
    [9.416897986437732, 46.466549721856694],
    [9.371351144747365, 46.507317602768126],
    [9.284812145536904, 46.48850545435542],
    [9.257484040523906, 46.44144660821985],
    [9.289366829705926, 46.40062936825518],
    [9.284812145536904, 46.35663816570974],
    [9.284812145536904, 46.29058490512185],
    [9.20282783049663, 46.1992373783755],
    [9.098070094610051, 46.12036741937587],
    [9.098070094610051, 46.07615085822019],
    [9.029749832075709, 46.04454589143285],
    [9.00697641123051, 45.97495128133343],
    [9.025195147906686, 45.936953675520954],
    [9.088960726272006, 45.89576019997904],
    [9.029749832075709, 45.81963036518471],
    [8.920437412020078, 45.835499342834254],
    [8.94776551703427, 45.870395169411665],
    [8.897663991176103, 45.95595573525324],
    [8.788351571120444, 45.984446611799655],
    [8.829343728641703, 46.0919465575233],
    [8.715476624417022, 46.0919465575233],
    [8.606164204362614, 46.155084129680944],
    [8.460414310955855, 46.24020507964099],
    [8.437640890110686, 46.29687912789802],
    [8.47407836346295, 46.384922293059105],
    [8.437640890110686, 46.463412465457026],
    [8.305555049211051, 46.4288907120785],
    [8.319219101718147, 46.40062936825518],
    [8.273672260027809, 46.36292479314707],
    [8.21446136583154, 46.30946540325735],
    [8.137031734959123, 46.30317262727428],
    [8.086930209100956, 46.26854942852262],
    [8.118812998283005, 46.246505089875996],
    [8.164359839973343, 46.18977895248844],
    [8.15525047163527, 46.14246240388232],
    [8.027719314904658, 46.09826357091029],
    [8.018609946566613, 46.016085953093665],
    [7.8956334740038585, 45.984446611799655],
    [7.831867895638538, 45.924282016933006],
    [7.603935460709835, 45.99015578378862],
    [7.3929619873358945, 45.92071933114531],
    [7.169835086839441, 45.88544370119848]
            ]]
        }
    }
}

def afficher_indice_pays(pays):
    st.title(f"Indices boursiers pour {pays}")
    if pays in indices_boursiers:
        data = indices_boursiers[pays]
        df = pd.DataFrame(list(data.items()), columns=["Indice", "Valeur"])
        st.table(df)
    else:
        st.write("Données non disponibles.")

def afficher_carte():
    m = folium.Map(location=[48.8566, 2.3522], zoom_start=4)

    # Ajouter des polygones colorés pour chaque pays
    couleurs = {
        "France": "blue",
        "Allemagne": "yellow",
        "Portugal": "green",
        "Suisse": "red"
    }

    for pays, geojson in geojson_data.items():
        folium.GeoJson(
            geojson,
            style_function=lambda x, couleur=couleurs[pays]: {'color': couleur, 'fillColor': couleur, 'fillOpacity': 0.5},
            highlight_function=lambda x: {'weight': 3, 'color': 'black'},
            tooltip=folium.Tooltip(pays),
            popup=folium.Popup(f"<a href='?pays={pays}'>{pays}</a>")
        ).add_to(m)

    st_folium(m, width=700, height=500)

# Début de l'application Streamlit
st.set_page_config(page_title="Carte des Indices Boursiers", layout="wide")

pays_selectionne = st.experimental_get_query_params().get('pays', [None])[0]

if pays_selectionne:
    afficher_indice_pays(pays_selectionne)
else:
    st.title("Carte des Indices Boursiers en Europe")
    afficher_carte()
